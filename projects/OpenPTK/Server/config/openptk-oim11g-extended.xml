<?xml version="1.0" encoding="ISO-8859-1"?>
<OpenPTK xmlns='http://xml.netbeans.org/schema/openptk'
         xmlns:xsi='http://www.w3.org/2001/XMLSchema-instance'
         xsi:schemaLocation='http://xml.netbeans.org/schema/openptk openptk.xsd'>
   <!--
      Notes: 1. To reference a Property value use the "%{property_name}"
      syntax. The Property value is evaluated when the XML file is parsed
      and processed. 2. To reference an Attribute value use the
      "${attribute_name}" syntax. The Attribute value is evaluated at
      run-time when the Property is used.
   -->
   <!--
      Defaults: These Properties are made available for reference by other
      Properties using the "%{property_name}" syntax. These Properties are
      NOT automatically copied into any of the other Properties defined in
      this file.
   -->
   <!--
      Idm urls: http://localhost:8080/idm/servlet/rpcrouter2
      http://localhost:28080/idm8/servlet/rpcrouter2
      http://www.openptk.org/idm/servlet/rpcrouter2
      http://www.openptk.org/idm/servlet/openspml2
   -->
   <Defaults>
      <Properties>
         <Property name="oim11g.url"                          value="t3://icam.securegov.org:14000" />  <!-- t3://oim11g:7002  -->
         <Property name="oim11g.user.name"                    value="xelsysadm" />
         <Property name="oim11g.user.password"                value="AWSora1_g" />  <!-- Passw0rd -->
         <!-- Property name="oim11g.user.password.encrypted" value="fJUAFjIMLNh/WiRBCBz3hw==" / -->
         <Property name="timeout.read"                        value="20000" />
         <Property name="timeout.write"                       value="20000" />
         <Property name="debug.level"                         value="1" /> <!-- 1=CONFIG (default) -->
         <Property name="plugin.sendemail.file"               value="openptk.mail" />
         <Property name="plugin.sendemail.authen.user"        value="donotreply@openptk.org" />
         <Property name="plugin.sendemail.authen.password"    value="__NEED_VALUE__" />
         <Property name="plugin.template.library"             value="templates" />
         <Property name="email.fromaddress"                   value="donotreply@openptk.org"/>
         <Property name="cookie.name"                         value="OPENPTKSESSIONID" />
         <Property name="target.classname"                    value="org.openptk.authorize.BasicTarget"/>
         <Property name="timestamp"                           value="true" />
         <Property name="logger.default"                      value="UnixLogFile" />
         <Property name="database.sample"                     value="databases/sampledb" />
      </Properties>
   </Defaults>
   <!--
      Global: These Properties are for global configuration of the OpenPTK Server.
   -->
   <Global>
      <Properties>
         <Property name="openptk.temp"                 value="/var/tmp/openptk" />
         <Property name="auth.token.name.clientid"     value="clientid" />
         <Property name="auth.token.name.clientcred"   value="clientcred" />
         <Property name="auth.token.name.password"     value="password" />
         <Property name="auth.token.name.user"         value="user" />
         <Property name="auth.token.name.tokenparam"   value="token" />
         <Property name="http.session.cookie.uniqueid" value="%{cookie.name}" />
         <Property name="http.session.cookie.httponly" value="true" />
         <Property name="engine.session.kill"          value="43200000" /> <!-- msec ( 12 hours = 43200000 ) -->
         <Property name="engine.session.ttl"           value="1800000" /> <!-- msec ( 30 minutes = 1800000 ) -->
         <Property name="engine.session.cache.ttl"     value="120000" /> <!-- msec (2 minutes) -->
         <Property name="engine.session.scan.delay"    value="30" />  <!-- minutes -->
         <Property name="engine.session.scan.sleep"    value="5" />  <!-- minutes -->
         <Property name="search.results.quantity"      value="10" />
         <Property name="search.contains.minchar"      value="3" />
         <Property name="search.attribute.default"     value="firstname" />
         <Property name="server.config.userid"         value="openptkconfig" />
         <Property name="server.config.password.encrypted"  value="EnespBAb/hMwNylyxlh0jw==" />
         <Property name="server.cookiepath"            value="/" />
         <Property name="server.defaultclient"         value="anon" />
         <Property name="security.enforcer.servlet"    value="webfilter" />
         <Property name="security.enforcer.engine"     value="operation" />
      </Properties>
   </Global>
   <!--
      Contexts: The Contexts section contains Properties (that will be
      applied to each Context) One or more Context. A given Context contains
      the following elements: - Properties that are unique to the Context
      All of the "Contexts" level Properties will be copied into each
      Context then the Context specific Properties will be added/overlayed.
      - Query that will be applied to all of the Operations - Operations
      that will be supported by a given Context. Each Operation will inherit
      the Properties and Query (if exist) from the Context level. Operation
      level Properties will be added/overlayed. The Query will be replaced.
      Each Operation is required to have the following Properties: -
      classname - AttrGroup
   -->

   <Contexts>
      <Properties>
         <Property name="context.default"           value="User-Oracle-OIMClient" />
         <Property name="context.classname"         value="org.openptk.context.TimeoutContext" /> <!-- org.openptk.context.TimeoutContext -->
         <Property name="security.encryption.id"    value="PBEWithMD5AndDES" />
         <Property name="audit"                     value="false" />
      </Properties>

      <Context id="User-Oracle-OIMClient" enabled="true" definition="UserOIM11g" connection="OIM11g" association="OIM11G-USER">
         <Properties>
            <Property name="context.description"  value="Oracle Identity Manager 11g, OIMClient User" />
            <Property name="operation.classname"  value="org.openptk.spi.operations.OIMClientUserOperations" />
            <Property name="key"                  value="uniqueid" />
            <Property name="search.default.order" value="firstname,lastname,uniqueid,email" />
            <Property name="search.operators"     value="AND,OR,CONTAINS,EQ" />
         </Properties>
         <Operations>
            <Operation id="create" attrgroup="user-oim11g-create">
               <Properties>
                  <Property name="timeout" value="%{timeout.write}" />
               </Properties>
            </Operation>
            <Operation id="read"   attrgroup="user-oim11g-read">
               <Properties>
                  <Property name="timeout" value="%{timeout.read}" />
               </Properties>
            </Operation>
            <Operation id="search" attrgroup="user-oim11g-search">
               <Properties>
                  <Property name="timeout" value="%{timeout.read}" />
                  <Property name="sort"    value="lastname,firstname" />
               </Properties>
            </Operation>
            <Operation id="update" attrgroup="user-oim11g-update" >
               <Properties>
                  <Property name="timeout" value="%{timeout.write}" />
               </Properties>
            </Operation>
            <Operation id="delete" attrgroup="user-oim11g-delete">
               <Properties>
                  <Property name="timeout" value="%{timeout.write}" />
               </Properties>
            </Operation>
            <Operation id="pwdchange" attrgroup="user-oim11g-pwd">
               <Properties>
                  <Property name="timeout" value="%{timeout.write}" />
               </Properties>
            </Operation>
            <Operation id="pwdreset" attrgroup="user-oim11g-pwd">
               <Properties>
                  <Property name="timeout" value="%{timeout.write}" />
               </Properties>
            </Operation>
            <Operation id="pwdforgot" attrgroup="user-oim11g-forgot" >
               <Properties>
                  <Property name="timeout" value="%{timeout.write}" />
               </Properties>
            </Operation>
            <Operation id="authenticate" attrgroup="user-oim11g-pwd" />
         </Operations>
      </Context>

      <Context id="Register-Oracle-OIMClient" enabled="true" definition="UnauthenOIM11g" connection="OIM11g" association="OIM11G-UNAUTHEN">
         <Properties>
            <Property name="context.description"   value="Oracle Identity Manager 11g, OIMClient Registration" />
            <Property name="operation.classname"   value="org.openptk.spi.operations.OIMClientUnauthenOperations" />
            <Property name="key"                   value="uniqueid" />
            <Property name="template.registration" value="Self-Register User" />
         </Properties>
         <Operations>
            <Operation id="create" attrgroup="register-oim11g-create">
               <Properties>
                  <Property name="timeout" value="%{timeout.write}" />
               </Properties>
            </Operation>
         </Operations>
      </Context>

      <Context id="RequestRole-Oracle-OIMClient" enabled="true" definition="RequestRoleOIM11g" connection="OIM11g" association="OIM11G-REQUEST-ROLE">
         <Properties>
            <Property name="context.description"             value="Oracle Identity Manager 11g, Request for Role" />
            <Property name="operation.classname"             value="org.openptk.spi.operations.OIMClientRequestRoleOperations" />
            <Property name="key"                             value="uniqueid" />
            <Property name="request.attribute.justification" value="justification" />
            <Property name="request.attribute.rolename"      value="rolename" />
            <Property name="request.attribute.failure"       value="failure" />
            <Property name="request.attribute.status"        value="status" />
            <Property name="request.attribute.userid"        value="userid" />
            <Property name="request.attribute.template"      value="template" />
            <Property name="request.beneficiarytype"         value="user" />
            <Property name="request.entitytype"              value="Role" />
         </Properties>
         <Operations>
            <Operation id="create" attrgroup="requestrole-oim11g-create"/>
            <Operation id="read"   attrgroup="requestrole-oim11g-read" />
            <Operation id="delete" attrgroup="requestrole-oim11g-delete" />
            <Operation id="search" attrgroup="requestrole-oim11g-search" />
         </Operations>
      </Context>

      <Context id="RequestResource-Oracle-OIMClient" enabled="true" definition="RequestResourceOIM11g" connection="OIM11g" association="OIM11G-REQUEST-RESOURCE">
         <Properties>
            <Property name="context.description"             value="Oracle Identity Manager 11g, Request for Resource" />
            <Property name="operation.classname"             value="org.openptk.spi.operations.OIMClientRequestResourceOperations" />
            <Property name="key"                             value="uniqueid" />
            <Property name="request.attribute.justification" value="justification" />
            <Property name="request.attribute.resourcename"  value="resourcename" />
            <Property name="request.attribute.failure"       value="failure" />
            <Property name="request.attribute.status"        value="status" />
            <Property name="request.attribute.userid"        value="userid" />
            <Property name="request.attribute.template"      value="template" />
            <Property name="request.beneficiarytype"         value="user" />
            <Property name="request.entitytype"              value="Resource" />
         </Properties>
         <Operations>
            <Operation id="create" attrgroup="requestresource-oim11g-create"/>
            <Operation id="read"   attrgroup="requestresource-oim11g-read" />
            <Operation id="delete" attrgroup="requestresource-oim11g-delete" />
            <Operation id="search" attrgroup="requestresource-oim11g-search" />
         </Operations>
      </Context>

   </Contexts>
   <!--
      Attribute Groups define what attributes to use for a given Operation
      Attributes must have been declared in the related Association
   -->
   <AttrGroups>
    
      <AttrGroup id="user-oim11g-create">
         <Attributes>
            <Attribute id="firstname" />
            <Attribute id="lastname" />
            <Attribute id="email" />
            <Attribute id="roles" />
            <Attribute id="password" />
            <Attribute id="type" />
            <Attribute id="title" />
            <Attribute id="manager" />
            <Attribute id="telephone" />
         </Attributes>
      </AttrGroup>
      <AttrGroup id="user-oim11g-read">
         <Attributes>
            <Attribute id="firstname" />
            <Attribute id="lastname" />
            <Attribute id="email" />
            <Attribute id="roles" />
            <Attribute id="lastcommafirst" />
            <Attribute id="fullname" />
            <Attribute id="type" />
            <Attribute id="uniqueid" />
            <Attribute id="status" />
            <Attribute id="title"/>
            <Attribute id="manager" />
            <Attribute id="telephone" />
            <Attribute id="forgottenPasswordQuestions" />
         </Attributes>
      </AttrGroup>
      <AttrGroup id="user-oim11g-update">
         <Attributes>
            <Attribute id="firstname" />
            <Attribute id="lastname" />
            <Attribute id="email" />
            <Attribute id="roles" />
            <Attribute id="password" />
            <Attribute id="type" />
            <Attribute id="title"/>
            <Attribute id="manager" />
            <Attribute id="telephone" />
            <Attribute id="forgottenPasswordQuestions" />
            <Attribute id="forgottenPasswordAnswers" />
         </Attributes>
      </AttrGroup>
      <AttrGroup id="user-oim11g-delete" />
      <AttrGroup id="user-oim11g-search">
         <Attributes>
            <Attribute id="uniqueid" />
            <Attribute id="firstname" />
            <Attribute id="lastname" />
            <Attribute id="email" />
            <Attribute id="lastcommafirst" />
            <Attribute id="roles" />
         </Attributes>
      </AttrGroup>
      <AttrGroup id="user-oim11g-pwd">
         <Attributes>
            <Attribute id="password" />
         </Attributes>
      </AttrGroup>
      <AttrGroup id="user-oim11g-forgot">
         <Attributes>
            <Attribute id="forgottenPasswordQuestions" />
            <Attribute id="forgottenPasswordAnswers" />
            <Attribute id="forgottenPasswordValues" />
         </Attributes>
      </AttrGroup>

      <AttrGroup id="register-oim11g-create">
         <Attributes>
            <Attribute id="firstname" />
            <Attribute id="lastname" />
            <Attribute id="middlename" />
            <Attribute id="gender" />
            <Attribute id="dob" />
            <Attribute id="last4ssn" />
            <Attribute id="driverlic" />
            <Attribute id="homephone" />
            <Attribute id="homeaddress1" />
            <Attribute id="homecity" />
            <Attribute id="homecounty" />
            <Attribute id="homestate" />
            <Attribute id="homezip" />
            <Attribute id="homecountry" />
            <Attribute id="email" />
            <Attribute id="password" />
            <Attribute id="forgottenPasswordQuestions" />
            <Attribute id="forgottenPasswordAnswers" />
         </Attributes>
      </AttrGroup>

      <AttrGroup id="requestrole-oim11g-create">
         <Attributes>
            <Attribute id="template" />
            <Attribute id="justification" />
            <Attribute id="rolename" />
            <Attribute id="userid" />
          </Attributes>
      </AttrGroup>
      <AttrGroup id="requestrole-oim11g-read">
         <Attributes>
            <Attribute id="template" />
            <Attribute id="justification" />
            <Attribute id="rolename" />
            <Attribute id="userid" />
            <Attribute id="failure" />
            <Attribute id="status" />
          </Attributes>
      </AttrGroup>
      <AttrGroup id="requestrole-oim11g-delete" />
      <AttrGroup id="requestrole-oim11g-search">
         <Attributes>
            <Attribute id="rolename" />
            <Attribute id="userid" />
            <Attribute id="status" />
         </Attributes>
      </AttrGroup>

      <AttrGroup id="requestresource-oim11g-create">
         <Attributes>
            <Attribute id="template" />
            <Attribute id="justification" />
            <Attribute id="resourcename" />
            <Attribute id="userid" />
         </Attributes>
      </AttrGroup>
      <AttrGroup id="requestresource-oim11g-read">
         <Attributes>
            <Attribute id="template" />
            <Attribute id="justification" />
            <Attribute id="resourcename" />
            <Attribute id="userid" />
            <Attribute id="failure" />
            <Attribute id="status" />
         </Attributes>
      </AttrGroup>
      <AttrGroup id="requestresource-oim11g-delete" />
      <AttrGroup id="requestresource-oim11g-search">
         <Attributes>
            <Attribute id="resourcename" />
            <Attribute id="userid" />
            <Attribute id="status" />
         </Attributes>
      </AttrGroup>

   </AttrGroups>
   <!--
      Maps OpenPTK Framework Attribute names to Service Attribute names
      Framework Attributes NOT listed in a given Association will be treated
      as "pass through", their Framework Attribute name will be used for
      their Service Attribute name. Declares the Atributes that are
      available in a given "Service" All of the Attributes must be defined
      in the "associated" Definition Association Attributes can
      override/compliment "settings" from their Definition
   -->
   <Associations>

      <Association id="OIM11G-USER">
         <Attributes>
            <Attribute id="uniqueid"      servicename="User Login" />
            <Attribute id="firstname"     servicename="First Name" />
            <Attribute id="email"         servicename="Email" />
            <Attribute id="lastname"      servicename="Last Name" />
            <Attribute id="lastcommafirst" />
            <Attribute id="fullname" />
            <Attribute id="password"      servicename="usr_password" />
            <Attribute id="roles"         servicename="Role" />
            <Attribute id="organization"  servicename="act_key" />  <!-- Long -->
            <Attribute id="type"          servicename="Xellerate Type" />
            <Attribute id="status"        servicename="Status" />
            <Attribute id="title"         servicename="Title" />
            <Attribute id="manager"       servicename="usr_manager_key"/>
            <Attribute id="telephone"     servicename="Telephone Number" />
            <Attribute id="forgottenPasswordQuestions" />
            <Attribute id="forgottenPasswordAnswers" />
            <Attribute id="forgottenPasswordValues" />
         </Attributes>
      </Association>

      <Association id="OIM11G-UNAUTHEN">
         <Attributes>
            <Attribute id="uniqueid"      servicename="User Login" />
            <Attribute id="lastname"      servicename="Last Name" />
            <Attribute id="firstname"     servicename="First Name" />
            <Attribute id="middlename"    servicename="Middle Name" />
            <Attribute id="gender"        servicename="GENDER"  />
            <Attribute id="dob"           servicename="DOB"  />
            <Attribute id="last4ssn"      servicename="LAST4SSN"  />
            <Attribute id="driverlic"     servicename="DLNUM"  />
            <Attribute id="homephone"     servicename="Home Phone"  />
            <Attribute id="homeaddress1"  servicename="HOMESTREET" />
            <Attribute id="homecity"      servicename="City"  />
            <Attribute id="homecounty"    servicename="County"  />
            <Attribute id="homestate"     servicename="State"  />
            <Attribute id="homezip"       servicename="ZIPCODE" />
            <Attribute id="homecountry"   servicename="Country"  />
            <Attribute id="email"         servicename="Email" />
            <Attribute id="password"      servicename="Password" />
            <Attribute id="organization"  servicename="Organizations" />
            <Attribute id="type"          servicename="User Type" />
            <Attribute id="forgottenPasswordQuestions" />
            <Attribute id="forgottenPasswordAnswers" />
            <Attribute id="forgottenPasswordValues" />
         </Attributes>
      </Association>

      <Association id="OIM11G-REQUEST-ROLE">
         <Attributes>
            <Attribute id="uniqueid" servicename="requestid"/>
            <Attribute id="template" />
            <Attribute id="justification" />
            <Attribute id="rolename" />
            <Attribute id="userid" />
            <Attribute id="failure" />
            <Attribute id="status" />
         </Attributes>
      </Association>

      <Association id="OIM11G-REQUEST-RESOURCE">
         <Attributes>
            <Attribute id="uniqueid" servicename="requestid"/>
            <Attribute id="template" />
            <Attribute id="justification" />
            <Attribute id="resourcename" />
            <Attribute id="userid" />
            <Attribute id="failure" />
            <Attribute id="status" />
         </Attributes>
      </Association>
      
   </Associations>
   <!--
      These are related to the OpenPTK Subject Interface and it's API A
      Definition contains Properties and Atttributes Each Attribute (within
      a Definition) supports a number of "well known" Properties. Here are
      the defaults: type = String multivalued = false required = false
      encrypted = false access = public
   -->
   <Definitions>
    
      <Definition id="UserOIM11g">
         <Properties>
            <Property name="definition.classname"           value="org.openptk.definition.BasicSubject" />
            <Property name="definition.description"         value="A User in Oracle Identity Manager 11g" />
            <Property name="definition.password"            value="password" />
            <Property name="definition.role"                value="Role" />
            <Property name="definition.challenge.questions" value="forgottenPasswordQuestions"/>
            <Property name="definition.challenge.answers"   value="forgottenPasswordAnswers"/>
            <Property name="definition.challenge.values"    value="forgottenPasswordValues"/>
         </Properties>
         <Attributes>
            <Attribute id="uniqueid" required="true">
               <Functions>
                  <Function id="FirstInitialLastName" useexisting="true" classname="org.openptk.definition.functions.FirstInitialLastname">
                     <Arguments>
                        <Argument name="first"     type="attribute" value="firstname" />
                        <Argument name="last"      type="attribute" value="lastname" />
                        <Argument name="maxlength" type="literal"   value="32" />
                     </Arguments>
                     <Operations>
                        <Operation type="create" />
                     </Operations>
                  </Function>
               </Functions>
            </Attribute>
            <Attribute id="firstname" required="true" />
            <Attribute id="lastname" required="true" />
            <Attribute id="title" />
            <Attribute id="email" required="true">
               <Functions>
                  <Function id="Concat" useexisting="true" classname="org.openptk.definition.functions.Concat">
                     <Arguments>
                        <Argument name="first"      type="attribute" value="firstname" />
                        <Argument name="dot"        type="literal"   value="." />
                        <Argument name="last"       type="attribute" value="lastname" />
                        <Argument name="at"         type="literal"   value="@" />
                        <Argument name="domainname" type="literal"   value="openptk.org" />
                     </Arguments>
                     <Operations>
                        <Operation type="create" />
                     </Operations>
                  </Function>
               </Functions>
            </Attribute>
            <Attribute id="lastcommafirst" virtual="true">
               <Functions>
                  <Function id="OutputLastFirst" classname="org.openptk.definition.functions.Concat">
                     <Arguments>
                        <Argument name="arg1" type="attribute" value="lastname" />
                        <Argument name="arg2" type="literal"   value=", " />
                        <Argument name="arg3" type="attribute" value="firstname" />
                     </Arguments>
                     <Operations>
                        <Operation type="read" />
                        <Operation type="search" />
                     </Operations>
                  </Function>
               </Functions>
            </Attribute>
            <Attribute id="fullname" virtual="true">
               <Functions>
                  <Function id="Concat" useexisting="true" classname="org.openptk.definition.functions.Concat">
                     <Arguments>
                        <Argument name="arg1" type="attribute" value="firstname" />
                        <Argument name="arg2" type="literal"   value=" " />
                        <Argument name="arg3" type="attribute" value="lastname" />
                     </Arguments>
                     <Operations>
                        <Operation type="read" />
                        <Operation type="search" />
                     </Operations>
                  </Function>
               </Functions>
            </Attribute>
            <Attribute id="password" required="true" encrypted="true">
               <Functions>
                  <Function id="Concat" useexisting="true" classname="org.openptk.definition.functions.Concat">
                     <Arguments>
                        <Argument name="initialPassword" type="literal" value="Passw0rd" />
                     </Arguments>
                     <Operations>
                        <Operation type="create" />
                     </Operations>
                  </Function>
               </Functions>
            </Attribute>
            <Attribute id="roles" required="true" multivalued="true" >
               <Functions>
                  <Function id="Concat" useexisting="false" classname="org.openptk.definition.functions.Concat">
                     <Arguments>
                        <Argument name="Val" type="literal" value="Full-Time" />
                     </Arguments>
                     <Operations>
                        <Operation type="create" />
                        <Operation type="update" />
                     </Operations>
                  </Function>
               </Functions>
            </Attribute>
            <Attribute id="type" required="true" >
               <Functions>
                  <Function id="Concat" useexisting="true" classname="org.openptk.definition.functions.Concat">
                     <Arguments>
                        <Argument name="val" type="literal" value="End-User" />
                     </Arguments>
                     <Operations>
                        <Operation type="create" />
                     </Operations>
                  </Function>
               </Functions>
            </Attribute>
            <Attribute id="manager" type="Long"/>
            <Attribute id="telephone" />
            <Attribute id="status" />
            <Attribute id="organization"/>
            <Attribute id="forgottenPasswordQuestions" multivalued="true" />
            <Attribute id="forgottenPasswordAnswers" multivalued="true" />
            <Attribute id="forgottenPasswordValues" multivalued="true" />
         </Attributes>
      </Definition>

      <Definition id="UnauthenOIM11g">
         <Properties>
            <Property name="definition.classname"           value="org.openptk.definition.BasicSubject" />
            <Property name="definition.description"         value="Unauthenticated Registration, Oracle Identity Manager 11g" />
            <Property name="definition.password"            value="password" />
            <Property name="definition.role"                value="Role" />
            <Property name="definition.challenge.questions" value="forgottenPasswordQuestions"/>
            <Property name="definition.challenge.answers"   value="forgottenPasswordAnswers"/>
            <Property name="definition.challenge.values"    value="forgottenPasswordValues"/>
         </Properties>
         <Attributes>
            <Attribute id="uniqueid" required="true">
               <Functions>
                  <Function id="FirstInitialLastName" useexisting="true" classname="org.openptk.definition.functions.FirstInitialLastname">
                     <Arguments>
                        <Argument name="first"     type="attribute" value="firstname" />
                        <Argument name="last"      type="attribute" value="lastname" />
                        <Argument name="maxlength" type="literal"   value="32" />
                     </Arguments>
                     <Operations>
                        <Operation type="create" />
                     </Operations>
                  </Function>
               </Functions>
            </Attribute>
            <Attribute id="lastname" required="true" />
            <Attribute id="firstname" required="true" />
            <Attribute id="email" required="true">
               <Functions>
                  <Function id="Concat" useexisting="true" classname="org.openptk.definition.functions.Concat">
                     <Arguments>
                        <Argument name="first"      type="attribute" value="firstname" />
                        <Argument name="dot"        type="literal"   value="." />
                        <Argument name="last"       type="attribute" value="lastname" />
                        <Argument name="at"         type="literal"   value="@" />
                        <Argument name="domainname" type="literal"   value="openptk.org" />
                     </Arguments>
                     <Operations>
                        <Operation type="create" />
                     </Operations>
                  </Function>
               </Functions>
            </Attribute>
            <Attribute id="password" required="true" encrypted="true">
               <Functions>
                  <Function id="Concat" useexisting="true" classname="org.openptk.definition.functions.Concat">
                     <Arguments>
                        <Argument name="initialPassword" type="literal" value="Passw0rd" />
                     </Arguments>
                     <Operations>
                        <Operation type="create" />
                     </Operations>
                  </Function>
               </Functions>
            </Attribute>
            <Attribute id="middlename" />
            <Attribute id="gender" />
            <Attribute id="dob" />
            <Attribute id="last4ssn"/>
            <Attribute id="driverlic"/>
            <Attribute id="homephone"/>
            <Attribute id="homeaddress1" />
            <Attribute id="homecity" />
            <Attribute id="homecounty"/>
            <Attribute id="homestate" />
            <Attribute id="homezip" />
            <Attribute id="homecountry" />
            <Attribute id="organization"/>
            <Attribute id="type"/>
            <Attribute id="forgottenPasswordQuestions" multivalued="true" />
            <Attribute id="forgottenPasswordAnswers" multivalued="true" />
            <Attribute id="forgottenPasswordValues" multivalued="true" />
         </Attributes>
      </Definition>

      <Definition id="RequestRoleOIM11g">
         <Properties>
            <Property name="definition.classname"   value="org.openptk.definition.BasicSubject" />
            <Property name="definition.description" value="Request Role, Oracle Identity Manager 11g" />
         </Properties>
         <Attributes>
            <Attribute id="uniqueid" />
            <Attribute id="template" required="true">
               <Functions>
                  <Function id="default" classname="org.openptk.definition.functions.Concat">
                     <Arguments>
                        <Argument name="default" type="literal" value="Assign Roles" />
                     </Arguments>
                     <Operations>
                        <Operation type="create" />
                     </Operations>
                  </Function>
               </Functions>
            </Attribute>
            <Attribute id="rolename" required="true"/>
            <Attribute id="userid" required="true"/>
            <Attribute id="justification" />
            <Attribute id="failure" readonly="true" />
            <Attribute id="status" readonly="true" />
         </Attributes>
      </Definition>

      <Definition id="RequestResourceOIM11g">
         <Properties>
            <Property name="definition.classname"   value="org.openptk.definition.BasicSubject" />
            <Property name="definition.description" value="Request Resource, Oracle Identity Manager 11g" />
         </Properties>
         <Attributes>
            <Attribute id="uniqueid" />
            <Attribute id="template" required="true">
               <Functions>
                  <Function id="default" classname="org.openptk.definition.functions.Concat">
                     <Arguments>
                        <Argument name="default" type="literal" value="Provision Resource" />
                     </Arguments>
                     <Operations>
                        <Operation type="create" />
                     </Operations>
                  </Function>
               </Functions>
            </Attribute>
            <Attribute id="resourcename" required="true"/>
            <Attribute id="userid" required="true"/>
            <Attribute id="justification" />
            <Attribute id="failure" readonly="true" />
            <Attribute id="status" readonly="true" />
         </Attributes>
      </Definition>

   </Definitions>
   <!--
      ========== Connections === Connection Properties for a given Service
   -->
   <Connections>
      <Properties>
         <Property name="service.classname" value="org.openptk.spi.BasicService" />
      </Properties>

      <Connection id="OIM11g">
         <Properties>
            <Property name="connection.description"  value="Oracle Identity Manager 11g Client API" />
            <Property name="user.name"               value="%{oim11g.user.name}" />
            <Property name="user.password"           value="%{oim11g.user.password}" />
            <Property name="user.password.encrypted" value="%{oim11g.user.password.encrypted}" />
            <Property name="client.authconfig"       value="conf/authwl.conf"/>
            <Property name="client.providerurl"      value="%{oim11g.url}"/>
            <Property name="forgot.challenge.0"      value="What is your favorite color?" />
            <Property name="forgot.challenge.1"      value="What is your mother's maiden name?"/>
            <Property name="forgot.challenge.2"      value="What is the city of your birth?" />
         </Properties>
      </Connection>
   </Connections>

   <!--
   The Loggers for recording audit and debug information
   NOTE: The "value" for "file" is just the filename ... it will be placed in openptk.temp
   -->

   <Loggers default="%{logger.default}">
      <Logger id="UnixLogFile">
         <Properties>
            <Property name="logger.classname" value="org.openptk.logging.SimpleLogger" />
            <Property name="file"             value="openptk.log" />
         </Properties>
      </Logger>
   </Loggers>

   <Encryptors default="PBEWithMD5AndDES">
      <Encryptor id="PBEWithMD5AndDES">
         <Properties>
            <Property name="crypto.classname" value="org.openptk.crypto.DESCrypto" />
         </Properties>
      </Encryptor>
   </Encryptors>

   <!--
   Client information
   -->

   <Clients>
      <Properties>
         <Property name="openptk.cookie.name" value="%{cookie.name}"/>
      </Properties>
      <Client id="anon">
         <Authenticators>
            <Authenticator id="Anonymous"/>
         </Authenticators>
         <Contexts default="User-Oracle-OIMClient"> 
            <Context id="User-Oracle-OIMClient" />
         </Contexts>
      </Client>
      <Client id="identitycentral">
         <Authenticators>
            <Authenticator id="OpenPTK-config"/>
            <Authenticator id="User-IdPass-OIMClient"/>
         </Authenticators>
         <Contexts default="User-Oracle-OIMClient">
            <Context id="User-Oracle-OIMClient" />
         </Contexts>
      </Client>
      <Client id="identitycentralapi" secret="N343EhOmFig6XL1liUuRIvmf">
         <Properties>
            <Property name="search.min.chars"        value="1" />
            <Property name="search.results.quantity"   value="10" />
            <Property name="server.relative.uri"       value="/openptk-server" />
         </Properties>
         <Authenticators>
            <Authenticator id="OpenPTK-config"/>
            <Authenticator id="User-IdPass-OIMClient"/>
         </Authenticators>
         <Contexts default="User-Oracle-OIMClient">
            <Context id="User-Oracle-OIMClient" />
         </Contexts>
      </Client>
      <Client id="openptkserver">
         <Authenticators>
            <Authenticator id="OpenPTK-config"/>
         </Authenticators>
         <Contexts default="User-Oracle-OIMClient">
            <Context id="User-Oracle-OIMClient" />
         </Contexts>
      </Client>
      <Client id="openptkserverapi" secret="N343EhOmFig6XL1liUuRIvmf">
         <Authenticators>
            <Authenticator id="OpenPTK-config"/>
         </Authenticators>
         <Contexts default="User-Oracle-OIMClient">
            <Context id="User-Oracle-OIMClient" />
         </Contexts>
      </Client>
      <Client id="portal" secret="gKZo9rUyLeY56vSsFpR4J9GJ">
         <Authenticators>
            <Authenticator id="User-IdPass-OIMClient"/>
            <Authenticator id="Anonymous"/>
         </Authenticators>
         <Contexts default="User-Oracle-OIMClient">
           <Context id="User-Oracle-OIMClient" />
         </Contexts>
      </Client>
      <Client id="uml" secret="WeacAymEnZqP34gDQuNfDsHE">
         <Authenticators>
            <Authenticator id="User-IdPass-OIMClient"/>
            <Authenticator id="OpenPTK-config"/>
         </Authenticators>
         <Contexts default="User-Oracle-OIMClient">
            <Context id="User-Oracle-OIMClient" />
         </Contexts>
      </Client>
      <Client id="register" secret="WeacAymEnZqP34gDQuNfDsHE">
         <Authenticators>
            <Authenticator id="Anonymous"/>
         </Authenticators>
         <Contexts default="Register-Oracle-OIMClient">
            <Context id="Register-Oracle-OIMClient"/>
         </Contexts>
      </Client>
      <Client id="console" secret="tLlGZ1rkok865iEmvomJEl4Z">
         <Authenticators>
            <Authenticator id="User-IdPass-OIMClient"/>
            <Authenticator id="OpenPTK-config"/>
         </Authenticators>
         <Contexts default="User-Oracle-OIMClient">
            <Context id="User-Oracle-OIMClient"/>
         </Contexts>
      </Client>
      <Client id="apitest" secret="McP7NoBoPTPHrJZLfXsnDEod">
         <Authenticators>
            <Authenticator id="User-IdPass-OIMClient"/>
            <Authenticator id="OpenPTK-config"/>
         </Authenticators>
         <Contexts default="User-Oracle-OIMClient">
            <Context id="User-Oracle-OIMClient"/>
         </Contexts>
      </Client>
      <Client id="taglibtest" secret="N343EhOmFig6XL1liUuRIvmf">
         <Authenticators>
            <Authenticator id="User-IdPass-OIMClient"/>
            <Authenticator id="OpenPTK-config"/>
         </Authenticators>
         <Contexts default="User-Oracle-OIMClient">
            <Context id="User-Oracle-OIMClient"/>
         </Contexts>
      </Client>
      <Client id="wsdl" secret="OkBh9iciqyMJufiLwwNR8CBR">
         <Authenticators>
            <Authenticator id="Anonymous"/>
         </Authenticators>
         <Contexts default="User-Oracle-OIMClient">
            <Context id="User-Oracle-OIMClient"/>
         </Contexts>
      </Client>
   </Clients>

   <!--
   Models
   -->
   <Models>
      <Properties>
         <Property name="model.classname" value="org.openptk.model.BasicModel"/>
      </Properties>
   </Models>

   <!--
   Converter Rules for the Structures
   -->

   <Converters>
      <Converter type="json" classname="org.openptk.structure.JsonConverter">
         <Structures>
            <Structure id="results">
               <Properties>
                  <Property name="children" value="list"/>
               </Properties>
            </Structure>
         </Structures>
      </Converter>
      <Converter type="xml" classname="org.openptk.structure.XmlConverter"/>
      <Converter type="html" classname="org.openptk.structure.HtmlConverter"/>
      <Converter type="plain" classname="org.openptk.structure.PlainConverter"/>
   </Converters>

   <!--
   Plugins: access to external processing
   -->

   <Plugins>
      <Plugin id="sendemail" enabled="true" classname="org.openptk.plugin.sendemail.SendEmailPlugin">
         <Properties>
            <Property name="sendemail.online"          value="true" />
            <Property name="sendemail.file"            value="%{plugin.sendemail.file}"/>
            <Property name="sendemail.authen.user"     value="%{plugin.sendemail.authen.user}" />
            <Property name="sendemail.authen.password" value="%{plugin.sendemail.authen.password}" />
            <Property name="mail.debug"                value="false" />
            <Property name="mail.host"                 value="localhost"/>
            <Property name="mail.transport.protocol"   value="smtp" />
            <Property name="mail.smtp.auth"            value="false" />
            <Property name="mail.smtp.port"            value="25" />
            <Property name="mail.smtp.quitwait"        value="false" />
         </Properties>
      </Plugin>
      <Plugin id="template" enabled="true" classname="org.openptk.plugin.template.TemplatePlugin">
         <Properties>
            <Property name="template.library"  value="%{plugin.template.library}" />
            <Property name="missing.attribute" value="variable" />
         </Properties>
      </Plugin>
   </Plugins>

   <!--
   OperationActions: Pre and Post logic for Context/Subject Operations
   -->

   <OperationActions>
      <Action id="ifexists" classname="org.openptk.context.actions.IfExistsThenUpdate">
      </Action>
      <Action id="notify" classname="org.openptk.context.actions.Notify">
         <Properties>
            <Property name="plugin.template" value="template"/>
            <Property name="plugin.email"    value="sendemail"/>
         </Properties>
      </Action>
   </OperationActions>

   <!--
   Security related information
   -->
   <Security>
      <!--
      Authentication mechanisms
      -->
      <Authenticators>
         <Authenticator id="Anonymous" level="ANON">
            <Properties>
               <Property name="authenticator.classname"   value="org.openptk.authenticate.AnonAuthenticator"/>
               <Property name="authenticator.description" value="Anonymous User"/>
            </Properties>
         </Authenticator>
         <Authenticator id="User-IdPass-OIMClient" level="USER">
            <Properties>
               <Property name="authenticator.classname"   value="org.openptk.authenticate.IdPassServiceAuthenticator"/>
               <Property name="authenticator.context"     value="User-Oracle-OIMClient"/>
               <Property name="authenticator.description" value="Users with User ID and Password verified against OIM 11g"/>
            </Properties>
         </Authenticator>
         <Authenticator id="User-Id-OIMClient" level="USER">
            <Properties>
               <Property name="authenticator.classname"   value="org.openptk.authenticate.IdServiceAuthenticator"/>
               <Property name="authenticator.context"     value="User-Oracle-OIMClient"/>
               <Property name="authenticator.description" value="Employees that exist in the Service"/>
            </Properties>
         </Authenticator>
         <Authenticator id="OpenPTK-config" level="SYSTEM">
            <Properties>
               <Property name="authenticator.classname"   value="org.openptk.authenticate.IdPassSystemAuthenticator"/>
               <Property name="authenticator.description" value="OpenPTK config against internal admin credentials"/>
            </Properties>
         </Authenticator>
      </Authenticators>

      <Deciders>
         <Decider id="internal">
            <Properties>
               <Property name="decider.classname" value="org.openptk.authorize.decider.BasicDecider"/>
            </Properties>
         </Decider>
      </Deciders>

      <Enforcers>
         <Properties>
            <Property name="enforcer.classname" value="org.openptk.authorize.BasicEnforcer"/>
         </Properties>
         <Enforcer id="webfilter" environment="SERVLET" decider="internal" />
         <Enforcer id="operation" environment="ENGINE"  decider="internal" />
      </Enforcers>

      <Policies>
         <Properties>
            <Property name="policy.classname" value="org.openptk.authorize.policy.BasicPolicy"/>
         </Properties>
         <Policy id="NotEnforcedURIs" environment="SERVLET" mode="inbound" effect="allow">
            <Properties>
               <Property name="policy.description" value="Not Enforced URIs"/>
            </Properties>
            <Session>
               <Types>
                  <Type id="INTERNAL"/>
                  <Type id="ANON"/>
                  <Type id="USER"/>
                  <Type id="SYSTEM"/>
               </Types>
            </Session>
            <Targets>
               <Target id="sessioninfo" type="uri" value="/resources/sessioninfo"/>
               <Target id="forgotP1" type="uri" value="/resources/contexts/./subjects/./password/forgot/questions"/>
               <Target id="forgotP2" type="uri" value="/resources/contexts/./subjects/./password/forgot/answers"/>
               <Target id="forgotP3" type="uri" value="/resources/contexts/./subjects/./password/forgot/change"/>
            </Targets>
         </Policy>
         <Policy id="ClientsURI" environment="SERVLET" mode="inbound" effect="allow">
            <Properties>
               <Property name="policy.description" value="Clients URI"/>
            </Properties>
            <Session>
               <Types>
                  <Type id="INTERNAL"/>
                  <Type id="ANON"/>
                  <Type id="USER"/>
                  <Type id="SYSTEM"/>
               </Types>
            </Session>
            <Targets>
               <Target id="clients" type="uri" value="/resources/clients/*" />
            </Targets>
         </Policy>
         <Policy id="ContextsURI" environment="SERVLET" mode="inbound" effect="allow">
            <Properties>
               <Property name="policy.description" value="Contexts URI"/>
            </Properties>
            <Session>
               <Types>
                  <Type id="ANON"/>
                  <Type id="USER"/>
                  <Type id="SYSTEM"/>
               </Types>
            </Session>
            <Targets>
               <Target id="contexts" type="uri" value="/resources/contexts/*" />
            </Targets>
         </Policy>
         <Policy id="EngineURIs" environment="SERVLET" mode="inbound" effect="allow">
            <Properties>
               <Property name="policy.description" value="Internal SYSTEM URIs"/>
            </Properties>
            <Session>
               <Types>
                  <Type id="ANON"/>
                  <Type id="SYSTEM"/>
               </Types>
            </Session>
            <Targets>
               <Target id="engine" type="uri" value="/resources/engine/*" />
            </Targets>
         </Policy>
         <Policy id="NotEnforcedOps" environment="ENGINE" mode="inbound" effect="allow">
            <Properties>
               <Property name="policy.description" value="Not enforced Operations"/>
            </Properties>
            <Session>
               <Types>
                  <Type id="INTERNAL"/>
                  <Type id="ANON"/>
                  <Type id="USER"/>
                  <Type id="SYSTEM"/>
               </Types>
            </Session>
            <Targets>
               <Target id="sessioninfo" type="uri" value="/resources/sessioninfo">
                  <Operations>
                     <Operation id="READ"/>
                  </Operations>
               </Target>
               <Target id="forgotP1" type="uri" value="/resources/contexts/./subjects/./password/forgot/questions">
                  <Operations>
                     <Operation id="PWDFORGOT"/>
                  </Operations>
               </Target>
               <Target id="forgotP2" type="uri" value="/resources/contexts/./subjects/./password/forgot/answers">
                  <Operations>
                     <Operation id="PWDFORGOT"/>
                  </Operations>
               </Target>
               <Target id="forgotP3" type="uri" value="/resources/contexts/./subjects/./password/forgot/change">
                  <Operations>
                     <Operation id="PWDFORGOT"/>
                  </Operations>
               </Target>
            </Targets>
         </Policy>
         <Policy id="AnonymousOps" environment="ENGINE" mode="inbound" effect="allow">
            <Properties>
               <Property name="policy.description" value="Anonymous Operations"/>
            </Properties>
            <Session>
               <Types>
                  <Type id="ANON"/>
                  <Type id="USER"/>
                  <Type id="SYSTEM"/>
               </Types>
            </Session>
            <Targets>
               <Target id="clients" type="uri" value="/resources/clients/*">
                  <Operations>
                     <Operation id="READ"/>
                  </Operations>
               </Target>
               <Target id="contexts" type="uri" value="/resources/contexts/*">
                  <Operations>
                     <Operation id="READ"/>
                     <Operation id="SEARCH"/>
                  </Operations>
               </Target>
            </Targets>
         </Policy>
         <Policy id="UserOps" environment="ENGINE" mode="inbound" effect="allow">
            <Properties>
               <Property name="policy.description" value="End-User Self Service"/>
            </Properties>
            <Session>
               <Types>
                  <Type id="USER"/>
               </Types>
            </Session>
            <Targets>
               <Target id="photo" type="uri" value="/resources/contexts/${session.principal.contextid}/subjects/${session.principal.uniqueid}/relationships/photo">
                  <Operations>
                     <Operation id="CREATE"/>
                  </Operations>
               </Target>
               <Target id="update" type="uri" value="/resources/contexts/${session.principal.contextid}/subjects/${session.principal.uniqueid}">
                  <Operations>
                     <Operation id="UPDATE"/>
                  </Operations>
               </Target>
               <Target id="pwdchange" type="uri" value="/resources/contexts/${session.principal.contextid}/subjects/${session.principal.uniqueid}/password/change">
                  <Operations>
                     <Operation id="PWDCHANGE"/>
                  </Operations>
               </Target>
            </Targets>
         </Policy>
         <Policy id="SystemOps" environment="ENGINE" mode="inbound" effect="allow">
            <Properties>
               <Property name="policy.description" value="System user access"/>
            </Properties>
            <Session>
               <Types>
                  <Type id="SYSTEM"/>
               </Types>
            </Session>
            <Targets>
               <Target id="contexts" type="uri" value="/resources/contexts/*">
                  <Operations>
                     <Operation id="CREATE"/>
                     <Operation id="READ"/>
                     <Operation id="UPDATE"/>
                     <Operation id="DELETE"/>
                     <Operation id="SEARCH"/>
                     <Operation id="PWDCHANGE"/>
                     <Operation id="PWDRESET"/>
                  </Operations>
               </Target>
               <Target id="engine" type="uri" value="/resources/engine/*">
                  <Operations>
                     <Operation id="READ"/>
                     <Operation id="SEARCH"/>
                  </Operations>
               </Target>
               <Target id="clients" type="uri" value="/resources/clients/*">
                  <Operations>
                     <Operation id="READ"/>
                     <Operation id="SEARCH"/>
                  </Operations>
               </Target>
            </Targets>
         </Policy>
         <Policy id="TrustedClients" environment="ENGINE" mode="inbound" effect="allow">
            <Properties>
               <Property name="policy.description" value="Trust these Clients for all operations"/>
            </Properties>
            <Session>
               <Types>
                  <Type id="ANON"/>
               </Types>
               <Clients>
                  <Client id="wsdl"/>
                  <Client id="portal"/>
                  <Client id="register"/>
               </Clients>
            </Session>
            <Targets>
               <Target id="all" type="uri" value="/resources/contexts/*">
                  <Operations>
                     <Operation id="CREATE"/>
                     <Operation id="READ"/>
                     <Operation id="UPDATE"/>
                     <Operation id="DELETE"/>
                     <Operation id="SEARCH"/>
                     <!-- password operations not allowed -->
                  </Operations>
               </Target>
            </Targets>
         </Policy>
      </Policies>
   </Security>

</OpenPTK>
